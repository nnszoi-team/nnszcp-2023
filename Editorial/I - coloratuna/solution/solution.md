#### 题目描述

给定 $q$ 个三元组 $\{l_i, r_i, v_i\}$，构造一个长为 $n$ 的序列 $a$，满足以下条件：

* $a_i \in \{1, 2, 3\}$；
* 对 $1 \le i \le q$，$\prod_{j = l_i}^{r_i} a_j \bmod 4 = v$。

或报告无解。

#### 题解

注意到

$$
3^i \bmod 4 = 
\begin{cases}
1, &i \bmod 2 = 0\\
3, &i \bmod 2 = 1
\end{cases}
$$

即 $3^i$ 对模 $4$ 的余数的贡献，$i$ 为奇数时是 $3$，反之为 $1$。

$$
2^i \bmod 4 = 3 \cdot 2^i \bmod 4 = 
\begin{cases}
1, &i = 0\\
2, &i = 1\\
0, &i \ge 2
\end{cases}
$$

即 $2^i$ 对模 $4$ 的余数的贡献，$i = 1$ 时余数为 $2$，$i \ge 2$ 时余数为 $0$，并且可以覆盖掉 $3^i$ 的影响。

而 $1^i$ 对模 $4$ 的余数并没有贡献。

因此，所有 $v_i = 1, 3$ 的限制的区间 $[l_i, r_i]$ 里，不能出现 $2$。

进一步，我们发现 $v_i = 1$ 代表区间里有偶数个 $3$，$v_i = 3$ 代表区间里有奇数个 $3$。

可以想到异或方程 $x_{l_i} \oplus x_{l_i + 1} \oplus \cdots \oplus x_{r_i} = 0 / 1$，其中每个 $x_i$ 代表第 $i$ 位填或者不填 $3$。

发现这样子做是 $\mathcal{O}(\frac{q^3}{w})$ 的，根本过不了。

那我们可以设一个前缀异或 $y_i = y_{i - 1} \oplus x_i$，每次方程变为 $y_{l_i - 1} \oplus y_{r_i} = 0/1$。

典中典之 Tarjan 缩点后 2-SAT，时间复杂度 $\mathcal{O}(q)$。

这还没完：怎么处理 $2$？

还是考虑一些区间：不能放 $2$ 的区间，能放 $1$ 个 $2$ 的区间和放 $2$ 个及以上 $2$ 的区间。

记录 $c_i$ 为前缀 $2$ 的个数，然后跑差分约束即可。

据此，我们以 $\mathcal{O}(n + q + nq)$ 的时间复杂度解决了此题。
